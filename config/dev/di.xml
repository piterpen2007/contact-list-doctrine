<?xml version="1.0" encoding="UTF-8" ?>
<container xmlns="http://symfony.com/schema/dic/services"
           xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
           xsi:schemaLocation="http://symfony.com/schema/dic/services http://symfony.com/schema/dic/services/services-1.0.xsd"
>

    <imports>
        <import resource="request.handlers.xml"/>
        <import resource="reqExp.handlers.xml"/>
        <import resource="app.config.xml"/>
    </imports>
    <parameters>
        <parameter key="controllerNs">EfTech\ContactList\Controller</parameter>
    </parameters>
<services>
    <defaults autowire="true" public="false">
        <bind key="string $pathToRecipients"
              type="expression">service(
            'EfTech\\ContactList\\Config\\AppConfig'
            ).getPathToRecipients()
        </bind>
        <bind key="string $pathToKinsfolk"
              type="expression">service(
            'EfTech\\ContactList\\Config\\AppConfig'
            ).getPathToKinsfolk()
        </bind>
        <bind key="string $pathToCustomers"
              type="expression">service(
            'EfTech\\ContactList\\Config\\AppConfig'
            ).getPathToCustomers()
        </bind>
        <bind key="string $pathToColleagues"
              type="expression">service(
            'EfTech\\ContactList\\Config\\AppConfig'
            ).getPathToColleagues()
        </bind>
        <bind key="string $pathToContactList"
              type="expression">service(
            'EfTech\\ContactList\\Config\\AppConfig'
            ).getPathToContactList()
        </bind>
        <bind key="string $pathToAddress"
              type="expression">service(
            'EfTech\\ContactList\\Config\\AppConfig'
            ).getPathToAddresses()
        </bind>
        <bind key="string $pathToUsers"
              type="expression">service(
            'EfTech\\ContactList\\Config\\AppConfig'
            ).getPathToUsers()
        </bind>
        <bind key="string $pathToFile"
              type="expression">service(
            'EfTech\\ContactList\\Config\\AppConfig'
            ).getPathToLogFile()
        </bind>
        <bind key="string $controllerNs">%controllerNs%</bind>
    </defaults>




    <prototype namespace="EfTech\ContactList\" resource="./../../src"/>
    <prototype namespace="EfTech\ContactList\Infrastructure\" resource="./../../vendor/eff-tech/framework-home/src"/>
    <instanceof id="EfTech\ContactList\Infrastructure\Controller\ControllerInterface" public="true"/>
    <instanceof id="EfTech\ContactList\Infrastructure\Router\RouterInterface" public="true"/>
    <instanceof id="EfTech\ContactList\Infrastructure\Console\CommandInterface" public="true"/>





    <service
            id="EfTech\ContactList\Infrastructure\Console\Output\OutputInterface"
            class="EfTech\ContactList\Infrastructure\Console\Output\EchoOutput"
            public="true"
    />

    <service id="EfTech\ContactList\Config\AppConfig" public="true">
        <factory class="EfTech\ContactList\Config\AppConfig" method="createFromArray"/>
        <argument key="$config">%app.configs%</argument>
    </service>



    <service id="EfTech\ContactList\Infrastructure\Auth\HttpAuthProvider">
        <argument key="$loginUri" type="service">
            <service>
                <factory class="EfTech\ContactList\Infrastructure\Uri\Uri" method="createFromString"/>
                <argument key="$uri" type="expression">service('EfTech\\ContactList\\Config\\AppConfig').getLoginUri()</argument>
            </service>
        </argument>
</service>

    <service
            id="EfTech\ContactList\Infrastructure\Auth\UserDataStorageInterface"
            class="EfTech\ContactList\Repository\UserJsonFileRepository">
    </service>

    <service id="EfTech\ContactList\Infrastructure\ViewTemplate\ViewTemplateInterface"
             class="EfTech\ContactList\Infrastructure\ViewTemplate\PhtmlTemplate"/>

    <service id="EfTech\ContactList\Infrastructure\Session\SessionInterface">
        <factory class="EfTech\ContactList\Infrastructure\Session\SessionNative" method="create"/>
    </service>

<service id="EfTech\ContactList\Infrastructure\DataLoader\DataLoaderInterface"
         class="EfTech\ContactList\Infrastructure\DataLoader\JsonDataLoader"/>

    <service id="EfTech\ContactList\Infrastructure\Logger\LoggerInterface"
             public="true"
             class="EfTech\ContactList\Infrastructure\Logger\Logger">
    </service>
    <service id="EfTech\ContactList\Infrastructure\Logger\AdapterInterface"
             class="EfTech\ContactList\Infrastructure\Logger\Adapter\FileAdapter"
    >
    </service>

    <service id="EfTech\ContactList\Entity\ContactRepositoryInterface"
             class="EfTech\ContactList\Repository\ContactJsonRepository"
    >
    </service>


    <service id="EfTech\ContactList\Entity\ContactListRepositoryInterface"
             class="EfTech\ContactList\Repository\ContactListJsonRepository"
    >
    </service>


    <service id="EfTech\ContactList\Entity\CustomerRepositoryInterface"
             class="EfTech\ContactList\Repository\CustomerJsonFileRepository"
    >
    </service>



    <service id="EfTech\ContactList\Entity\RecipientRepositoryInterface"
             class="EfTech\ContactList\Repository\RecipientJsonFileRepository"
    >
    </service>



    <service id="EfTech\ContactList\Infrastructure\View\RenderInterface"
             class="EfTech\ContactList\Infrastructure\View\DefaultRender"
             public="true"
    />

    <service id="EfTech\ContactList\Infrastructure\Router\ControllerFactory">
        <argument key="$diContainer" type="service" id="service_container"/>
    </service>

    <service id="EfTech\ContactList\Infrastructure\Router\DefaultRouter">
        <argument key="$handlers">%request.handlers%</argument>
    </service>

    <service id="EfTech\ContactList\Infrastructure\Router\RegExpRouter">
        <argument key="$handlers">%reqExp.handlers%</argument>
    </service>

    <service id="EfTech\ContactList\Infrastructure\Router\RouterInterface"
             class="EfTech\ContactList\Infrastructure\Router\ChainRouters"
    >
        <argument type="service" id="EfTech\ContactList\Infrastructure\Router\DefaultRouter"/>
        <argument type="service" id="EfTech\ContactList\Infrastructure\Router\RegExpRouter"/>
        <argument type="service" id="EfTech\ContactList\Infrastructure\Router\UniversalRouter"/>
    </service>
</services>
</container>